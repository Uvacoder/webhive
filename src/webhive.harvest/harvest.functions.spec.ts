/* eslint-disable @typescript-eslint/tslint/config */
import expect from 'expect';
import { harvestResource, createEntry, entryDate } from './harvest.functions';
import { createReadStream } from 'fs';
import { Ant } from './ants';
import intoStream from 'into-stream';
import FeedParser from 'feedparser';

describe('harvest functions', () => {
    it('resource smoke test', () => {
        expect(harvestResource).toBeTruthy();
    });

    it('harvestResource playground', async () => {
        const stream = intoStream(`<?xml version="1.0"?>
<rss xmlns:a10="http://www.w3.org/2005/Atom" version="2.0">
  <channel>
    <title>javascriptkicks.com</title>
    <link>https://javascriptkicks.com/</link>
    <description>The latest published stories from JavaScriptKicks.com</description>
    <language>en-us</language>
    <copyright>DotNetKicks LLC</copyright>
    <generator>javascriptkicks.com</generator>
    <item>
      <guid isPermaLink="false">stories/157197</guid>
      <link>https://javascriptkicks.com/r/157197?url=https://aurelia.io/blog/2019/03/01/how-do-we-react-part-2/</link>
      <a10:author>
        <a10:name>Aurelia</a10:name>
        <a10:uri>https://javascriptkicks.com/@AureliaEffect</a10:uri>
      </a10:author>
      <title>How do we</title>
      <description>You may have noticed that most other frameworks don't have HoCs, render props or anything like React.Children. These account for a lot the differences between React and other frameworks. How would you solve these use cases if you had to switch to [other framework]?</description>
      <a10:updated>2019-03-01T18:10:25Z</a10:updated>
    </item>
  </channel>
</rss>
`);
        const result = await harvestResource({ stream });
        expect(result).toBeAn(Array);
        expect(result.length).toBeGreaterThan(0);
        const [item] = result;
        // console.log("item", item);
        expect(item).toBeTruthy();
        expect(item.title).toBe('How do we');
        const entry = createEntry(item, { defaultCategory: null } as any);
        // console.log("entry", entry);
    });

    it('createEntry with empty title', () => {
        // eslint-disable-next-line quotes
        const item: FeedParser.Item | any = {
            title: null,
            description:
                '<h3 id="amp-news-roundup-amp-as-a-service-signed-exchanges-bento-css-tree-shaking">AMP news roundup: AMP as a service, signed exchanges, Bento, CSS tree shaking</h3>\n<p>An AMP conference took place earlier this month in Japan. Malte Ubl, tech lead for AMP at Google, presented the keynote. My takeaways:</p>\n<ul>\n<li><p>AMP now supports a variety of content formats including web pages, ads, emails, and visual stories, so they no longer consider “AMP” to be an acronym for “Accelerated Mobile Pages” (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=173">2:53</a>).</p>\n</li>\n<li><p>AMP’s governance model consists of two committees with representatives from a total of 19 companies (and one independent expert), as well as 13 working groups, which are the “easiest way to contribute to AMP” (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=256">4:16</a>).</p>\n<p><img src="/media/amp-governance.png" alt=""></p>\n</li>\n<li><p>AMP is an evergreen JavaScript library. Improvements that are made to AMP, are automatically applied to all existing AMP pages on a weekly basis. They’re calling this <mark>AMP as a service</mark> (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=543s">9:03</a>).</p>\n<p>For example, AMP now automatically adds a lightbox experience to all images where it makes sense, and soon AMP will start automatically generating blurry image previews that appear instantly.</p>\n</li>\n</ul>\n<p>Other significant announcements:</p>\n<ul>\n<li><p>The mobile version of Google Search includes AMP results on search results pages. When the user taps on an AMP result, the AMP page loads from Google’s domain (<code>google.com</code>) and is displayed in the <a href="https://developers.google.com/search/docs/guides/about-amp">AMP Viewer</a>.</p>\n<p><img src="/media/amp-viewer.png" alt=""></p>\n<p>Google Search now supports an alternative: If a website signs its AMP pages, and the visitor uses Chrome for Android, then tapping on an AMP result instead loads the <mark>signed version of the AMP page</mark> from Google’s servers, but to the user it appears as if they have navigated to the website normally.</p>\n<p><img src="/media/signed-exchange.png" alt=""></p>\n<p>The technology that enables this is called <a href="https://developers.google.com/web/updates/2018/11/signed-exchanges">Signed HTTP Exchanges</a> (SXG). See the <a href="https://webmasters.googleblog.com/2019/04/instant-loading-amp-pages-from-your-own.html">announcement</a> on Google Webmaster Central Blog for more details. The <a href="https://tools.ietf.org/html/draft-yasskin-http-origin-signed-responses-05">specification</a> describes the following use case:</p>\n<blockquote>\n<p>In order to speed up loading but still maintain control over its\ncontent, an HTML page in a particular origin “O.com” could tell\nclients to load its subresources from an intermediate content\ndistributor that’s not authoritative, but require that those\nresources be signed by “O.com” so that the distributor couldn’t\nmodify the resources.</p>\n</blockquote>\n<p>Websites can add support for signed exchanges by running <a href="https://amp.dev/documentation/guides-and-tutorials/optimize-and-measure/signed-exchange">AMP Packager</a> on the server side. Cloudflare has launched a free feature called “<a href="https://blog.cloudflare.com/announcing-amp-real-url/">AMP Real URL</a>” that fully automates the signing process for AMP pages served from its CDN.</p>\n</li>\n<li><p><a href="https://mobile.twitter.com/cramforce/status/1118432194324725761">Malte Ubl</a>: “Bento AMP” is the name of an ongoing effort to unbundle AMP web components from AMP and make them <mark>usable in all web pages</mark> (for more info, see “What’s next in AMP” at <a href="https://youtu.be/rx74ySmQFXs?t=681">11:21</a>).</p>\n<p><img src="/media/bento-amp.png" alt=""></p>\n</li>\n<li><p><a href="https://mobile.twitter.com/westonruter/status/1118153761342418952">Weston Ruter</a>: The size of WordPress’s default theme (Twenty Nineteen) increased substantially in version 5.1, which broke AMP compatibility (AMP limits the amount of CSS to 50 KB). In response, we’ve made improvements to the <mark>CSS tree shaker</mark> in the AMP plugin for WordPress; we were able to cut the amount of CSS by more than half (from 70 KB to 33 KB).</p>\n<blockquote>\n<p>To achieve these improvements in Twenty Nineteen, style processing was improved in the following ways:</p>\n<ul>\n<li>Add tree shaking for attribute selectors</li>\n<li>Add tree shaking for <code>:lang()</code> selectors</li>\n<li>Expand externalization of <code>data:</code> URLs in <code>@font-face</code> rules</li>\n</ul>\n</blockquote>\n</li>\n</ul>',
            summary:
                '<h3 id="amp-news-roundup-amp-as-a-service-signed-exchanges-bento-css-tree-shaking">AMP news roundup: AMP as a service, signed exchanges, Bento, CSS tree shaking</h3>\n<p>An AMP conference took place earlier this month in Japan. Malte Ubl, tech lead for AMP at Google, presented the keynote. My takeaways:</p>\n<ul>\n<li><p>AMP now supports a variety of content formats including web pages, ads, emails, and visual stories, so they no longer consider “AMP” to be an acronym for “Accelerated Mobile Pages” (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=173">2:53</a>).</p>\n</li>\n<li><p>AMP’s governance model consists of two committees with representatives from a total of 19 companies (and one independent expert), as well as 13 working groups, which are the “easiest way to contribute to AMP” (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=256">4:16</a>).</p>\n<p><img src="/media/amp-governance.png" alt=""></p>\n</li>\n<li><p>AMP is an evergreen JavaScript library. Improvements that are made to AMP, are automatically applied to all existing AMP pages on a weekly basis. They’re calling this <mark>AMP as a service</mark> (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=543s">9:03</a>).</p>\n<p>For example, AMP now automatically adds a lightbox experience to all images where it makes sense, and soon AMP will start automatically generating blurry image previews that appear instantly.</p>\n</li>\n</ul>\n<p>Other significant announcements:</p>\n<ul>\n<li><p>The mobile version of Google Search includes AMP results on search results pages. When the user taps on an AMP result, the AMP page loads from Google’s domain (<code>google.com</code>) and is displayed in the <a href="https://developers.google.com/search/docs/guides/about-amp">AMP Viewer</a>.</p>\n<p><img src="/media/amp-viewer.png" alt=""></p>\n<p>Google Search now supports an alternative: If a website signs its AMP pages, and the visitor uses Chrome for Android, then tapping on an AMP result instead loads the <mark>signed version of the AMP page</mark> from Google’s servers, but to the user it appears as if they have navigated to the website normally.</p>\n<p><img src="/media/signed-exchange.png" alt=""></p>\n<p>The technology that enables this is called <a href="https://developers.google.com/web/updates/2018/11/signed-exchanges">Signed HTTP Exchanges</a> (SXG). See the <a href="https://webmasters.googleblog.com/2019/04/instant-loading-amp-pages-from-your-own.html">announcement</a> on Google Webmaster Central Blog for more details. The <a href="https://tools.ietf.org/html/draft-yasskin-http-origin-signed-responses-05">specification</a> describes the following use case:</p>\n<blockquote>\n<p>In order to speed up loading but still maintain control over its\ncontent, an HTML page in a particular origin “O.com” could tell\nclients to load its subresources from an intermediate content\ndistributor that’s not authoritative, but require that those\nresources be signed by “O.com” so that the distributor couldn’t\nmodify the resources.</p>\n</blockquote>\n<p>Websites can add support for signed exchanges by running <a href="https://amp.dev/documentation/guides-and-tutorials/optimize-and-measure/signed-exchange">AMP Packager</a> on the server side. Cloudflare has launched a free feature called “<a href="https://blog.cloudflare.com/announcing-amp-real-url/">AMP Real URL</a>” that fully automates the signing process for AMP pages served from its CDN.</p>\n</li>\n<li><p><a href="https://mobile.twitter.com/cramforce/status/1118432194324725761">Malte Ubl</a>: “Bento AMP” is the name of an ongoing effort to unbundle AMP web components from AMP and make them <mark>usable in all web pages</mark> (for more info, see “What’s next in AMP” at <a href="https://youtu.be/rx74ySmQFXs?t=681">11:21</a>).</p>\n<p><img src="/media/bento-amp.png" alt=""></p>\n</li>\n<li><p><a href="https://mobile.twitter.com/westonruter/status/1118153761342418952">Weston Ruter</a>: The size of WordPress’s default theme (Twenty Nineteen) increased substantially in version 5.1, which broke AMP compatibility (AMP limits the amount of CSS to 50 KB). In response, we’ve made improvements to the <mark>CSS tree shaker</mark> in the AMP plugin for WordPress; we were able to cut the amount of CSS by more than half (from 70 KB to 33 KB).</p>\n<blockquote>\n<p>To achieve these improvements in Twenty Nineteen, style processing was improved in the following ways:</p>\n<ul>\n<li>Add tree shaking for attribute selectors</li>\n<li>Add tree shaking for <code>:lang()</code> selectors</li>\n<li>Expand externalization of <code>data:</code> URLs in <code>@font-face</code> rules</li>\n</ul>\n</blockquote>\n</li>\n</ul>',
            date: '2019-04-29T05:00:00.000Z',
            pubdate: '2019-04-29T05:00:00.000Z',
            pubDate: '2019-04-29T05:00:00.000Z',
            link: 'https://webplatform.news/issues/2019-04-29',
            guid: 'https://webplatform.news/issues/2019-04-29',
            author: null,
            comments: null,
            origlink: null,
            image: {},
            source: {},
            categories: [],
            enclosures: [],
            'rss:@': {},
            'rss:title': { '@': {} },
            'rss:link': { '@': {}, '#': 'https://webplatform.news/issues/2019-04-29' },
            permalink: 'https://webplatform.news/issues/2019-04-29',
            'rss:guid': { '@': {}, '#': 'https://webplatform.news/issues/2019-04-29' },
            'rss:pubdate': { '@': {}, '#': 'Mon, 29 Apr 2019 05:00:00 GMT' },
            'rss:description': {
                '@': {},
                '#':
                    '<h3 id="amp-news-roundup-amp-as-a-service-signed-exchanges-bento-css-tree-shaking">AMP news roundup: AMP as a service, signed exchanges, Bento, CSS tree shaking</h3>\n<p>An AMP conference took place earlier this month in Japan. Malte Ubl, tech lead for AMP at Google, presented the keynote. My takeaways:</p>\n<ul>\n<li><p>AMP now supports a variety of content formats including web pages, ads, emails, and visual stories, so they no longer consider “AMP” to be an acronym for “Accelerated Mobile Pages” (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=173">2:53</a>).</p>\n</li>\n<li><p>AMP’s governance model consists of two committees with representatives from a total of 19 companies (and one independent expert), as well as 13 working groups, which are the “easiest way to contribute to AMP” (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=256">4:16</a>).</p>\n<p><img src="/media/amp-governance.png" alt=""></p>\n</li>\n<li><p>AMP is an evergreen JavaScript library. Improvements that are made to AMP, are automatically applied to all existing AMP pages on a weekly basis. They’re calling this <mark>AMP as a service</mark> (starts at <a href="https://youtu.be/1vwOFt9FBm4?t=543s">9:03</a>).</p>\n<p>For example, AMP now automatically adds a lightbox experience to all images where it makes sense, and soon AMP will start automatically generating blurry image previews that appear instantly.</p>\n</li>\n</ul>\n<p>Other significant announcements:</p>\n<ul>\n<li><p>The mobile version of Google Search includes AMP results on search results pages. When the user taps on an AMP result, the AMP page loads from Google’s domain (<code>google.com</code>) and is displayed in the <a href="https://developers.google.com/search/docs/guides/about-amp">AMP Viewer</a>.</p>\n<p><img src="/media/amp-viewer.png" alt=""></p>\n<p>Google Search now supports an alternative: If a website signs its AMP pages, and the visitor uses Chrome for Android, then tapping on an AMP result instead loads the <mark>signed version of the AMP page</mark> from Google’s servers, but to the user it appears as if they have navigated to the website normally.</p>\n<p><img src="/media/signed-exchange.png" alt=""></p>\n<p>The technology that enables this is called <a href="https://developers.google.com/web/updates/2018/11/signed-exchanges">Signed HTTP Exchanges</a> (SXG). See the <a href="https://webmasters.googleblog.com/2019/04/instant-loading-amp-pages-from-your-own.html">announcement</a> on Google Webmaster Central Blog for more details. The <a href="https://tools.ietf.org/html/draft-yasskin-http-origin-signed-responses-05">specification</a> describes the following use case:</p>\n<blockquote>\n<p>In order to speed up loading but still maintain control over its\ncontent, an HTML page in a particular origin “O.com” could tell\nclients to load its subresources from an intermediate content\ndistributor that’s not authoritative, but require that those\nresources be signed by “O.com” so that the distributor couldn’t\nmodify the resources.</p>\n</blockquote>\n<p>Websites can add support for signed exchanges by running <a href="https://amp.dev/documentation/guides-and-tutorials/optimize-and-measure/signed-exchange">AMP Packager</a> on the server side. Cloudflare has launched a free feature called “<a href="https://blog.cloudflare.com/announcing-amp-real-url/">AMP Real URL</a>” that fully automates the signing process for AMP pages served from its CDN.</p>\n</li>\n<li><p><a href="https://mobile.twitter.com/cramforce/status/1118432194324725761">Malte Ubl</a>: “Bento AMP” is the name of an ongoing effort to unbundle AMP web components from AMP and make them <mark>usable in all web pages</mark> (for more info, see “What’s next in AMP” at <a href="https://youtu.be/rx74ySmQFXs?t=681">11:21</a>).</p>\n<p><img src="/media/bento-amp.png" alt=""></p>\n</li>\n<li><p><a href="https://mobile.twitter.com/westonruter/status/1118153761342418952">Weston Ruter</a>: The size of WordPress’s default theme (Twenty Nineteen) increased substantially in version 5.1, which broke AMP compatibility (AMP limits the amount of CSS to 50 KB). In response, we’ve made improvements to the <mark>CSS tree shaker</mark> in the AMP plugin for WordPress; we were able to cut the amount of CSS by more than half (from 70 KB to 33 KB).</p>\n<blockquote>\n<p>To achieve these improvements in Twenty Nineteen, style processing was improved in the following ways:</p>\n<ul>\n<li>Add tree shaking for attribute selectors</li>\n<li>Add tree shaking for <code>:lang()</code> selectors</li>\n<li>Expand externalization of <code>data:</code> URLs in <code>@font-face</code> rules</li>\n</ul>\n</blockquote>\n</li>\n</ul>',
            },
        };
        const entry = createEntry(item, { defaultCategory: null } as any);
        expect(entry.title).toBeTruthy();
    });
});
